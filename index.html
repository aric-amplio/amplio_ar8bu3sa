<!doctype html>
<html>
    <head>
        <script src="https://aframe.io/releases/1.0.4/aframe.min.js"></script>
        <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar.js"></script>
        <script src="https://raw.githack.com/donmccurdy/aframe-extras/master/dist/aframe-extras.loaders.min.js"></script>
        <script src="https://raw.githack.com/AR-js-org/studio-backend/master/src/modules/marker/tools/gesture-detector.js"></script>
        <script src="https://raw.githack.com/AR-js-org/studio-backend/master/src/modules/marker/tools/gesture-handler.js"></script>

        <script>
            if ("webkitSpeechRecognition" in window) {
                let speechRecognition = new webkitSpeechRecognition();
                //let final_transcript = "";

                speechRecognition.continuous = true;
                speechRecognition.interimResults = true;
                speechRecognition.lang = "en-US";

                speechRecognition.addEventListener('end', () => speechRecognition.start());

                speechRecognition.onresult = (event) => {
                    let interim_transcript = "";
                    let final_transcript = "";
                    for (let i = event.resultIndex; i < event.results.length; ++i) {
                        if (event.results[i].isFinal) {
                            final_transcript = event.results[i][0].transcript;
                        } 
                        else {
                            interim_transcript = event.results[i][0].transcript;
                        }
                    }

                    if(final_transcript.toLowerCase().trim()=='panda' || interim_transcript.toLowerCase().trim()=='panda'){
                        //document.getElementById("final").setAttribute("text", "value", "OK!");
                        document.getElementById("bowser-model").setAttribute("gltf-model","assets/icecream_l.glb");
                        document.getElementById("bowser-model").setAttribute("scale","0.0025 0.0025 0.0025");
                    }else if(final_transcript.toLowerCase().trim()=='icecream' || interim_transcript.toLowerCase().trim()=='icecream'||
                        final_transcript.toLowerCase().trim()=='ice cream' || interim_transcript.toLowerCase().trim()=='ice cream')
                    {
                        document.getElementById("bowser-model").setAttribute("gltf-model","assets/panda_l.glb");
                        document.getElementById("bowser-model").setAttribute("scale","0.5 0.5 0.5");
                    }

                    //document.querySelector("#final").innerHTML = final_transcript;
                    if(final_transcript=="")
                        document.getElementById("final").value=interim_transcript;
                        //document.getElementById("final").setAttribute("text", "value",interim_transcript);
                    else
                        document.getElementById("final").value=final_transcript;
                    // document.querySelector("#interim").innerHTML = interim_transcript;
                };

                speechRecognition.start();

            }
        </script>
    </head>

    <body style="margin: 0; overflow: hidden;">
        <a-scene 
            vr-mode-ui="enabled: false;"
            loading-screen="enabled: false;"
            renderer="logarithmicDepthBuffer: true;"
            arjs="trackingMethod: best; sourceType: webcam; debugUIEnabled: false;"
            id="scene"
            embedded
            gesture-detector
        >
            <a-assets>
                <a-asset-item
                    id="animated-asset"
                    src="assets/panda_l.glb"
                ></a-asset-item>
            </a-assets>

            <a-marker
                id="animated-marker"
                type="pattern"
                preset="custom"
                url="assets/marker.patt"
                raycaster="objects: .clickable"
                emitevents="true"
                cursor="fuse: false; rayOrigin: mouse;"
                id="markerA"
            >
                <a-entity
                    id="bowser-model"
                    scale="0.5 0.5 0.5"
                    animation-mixer="loop: repeat"
                    gltf-model="#animated-asset"
                    class="clickable"
                    gesture-handler
                ></a-entity>
            </a-marker>

            
            <a-entity camera>  </a-entity>
            <!-- <a-entity id="final"  text="value: NAME THE IMAGE;color:blue;" position="0.4 0.25 -1"></a-entity> -->


        </a-scene>


            <input type="text"  id="final"  style="background-color: black;
            color:yellow;
            width: 300px;
            height: 50px;
            position: absolute;
            left: 45%;
            top:10px;
            text-align:center;
            font-size: x-large;"
            
            value="NAME THE IMAGE"/>

    </body>
</html>
