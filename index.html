<!doctype html>
<html>
    <head>
        <script src="https://aframe.io/releases/1.0.4/aframe.min.js"></script>
        <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar.js"></script>
        <script src="https://raw.githack.com/donmccurdy/aframe-extras/master/dist/aframe-extras.loaders.min.js"></script>
        <script src="https://raw.githack.com/AR-js-org/studio-backend/master/src/modules/marker/tools/gesture-detector.js"></script>
        <script src="https://raw.githack.com/AR-js-org/studio-backend/master/src/modules/marker/tools/gesture-handler.js"></script>

        <script>
            if ("webkitSpeechRecognition" in window) {
                let speechRecognition = new webkitSpeechRecognition();
                let final_transcript = "";

                speechRecognition.continuous = true;
                speechRecognition.interimResults = false;
                speechRecognition.lang = "en-US";


                speechRecognition.onresult = (event) => {
                    let interim_transcript = "";

                    for (let i = event.resultIndex; i < event.results.length; ++i) {
                        if (event.results[i].isFinal) {
                            final_transcript = event.results[i][0].transcript;
                        } 
                        // else {
                        //     interim_transcript = event.results[i][0].transcript;
                        // }
                    }

                    if(final_transcript.toLowerCase().trim()=='panda'){
                        //document.getElementById("final").setAttribute("text", "value", "OK!");
                        document.getElementById("bowser-model").setAttribute("gltf-model","assets/asset.gltf");
                        document.getElementById("bowser-model").setAttribute("scale","0.0025 0.0025 0.0025");
                    }
                    //document.querySelector("#final").innerHTML = final_transcript;
                    document.getElementById("final").setAttribute("text", "value", final_transcript);
                    // document.querySelector("#interim").innerHTML = interim_transcript;
                };

                speechRecognition.start();

            }
        </script>
    </head>

    <body style="margin: 0; overflow: hidden;">
        <a-scene
            vr-mode-ui="enabled: false;"
            loading-screen="enabled: false;"
            renderer="logarithmicDepthBuffer: true;"
            arjs="trackingMethod: best; sourceType: webcam; debugUIEnabled: false;"
            id="scene"
            embedded
            gesture-detector
        >
            <a-assets>
                <a-asset-item
                    id="animated-asset"
                    src="assets/asset.glb"
                ></a-asset-item>
            </a-assets>

            <a-marker
                id="animated-marker"
                type="pattern"
                preset="custom"
                url="assets/marker.patt"
                raycaster="objects: .clickable"
                emitevents="true"
                cursor="fuse: false; rayOrigin: mouse;"
                id="markerA"
            >
                <a-entity
                    id="bowser-model"
                    scale="3.1348454591021397 3.1348454591021397 3.1348454591021397"
                    animation-mixer="loop: repeat"
                    gltf-model="#animated-asset"
                    class="clickable"
                    gesture-handler
                ></a-entity>
            </a-marker>

            <a-entity camera></a-entity>
            <a-entity id="final"  text="value: Hello World;color:blue;" position="0 0 -1"></a-entity>
        </a-scene>
        
    </body>
</html>
